# B-0326 — Experiment E-006: ✅/❌ 스키마/배포 순서(Consumer-First vs Producer-First)

## Goal
- Producer-first + breaking change가 어떻게 장애를 만드는지 재현
- Consumer-first(호환성 + 방어코딩)로 어떻게 예방하는지 증명

## Scenario (Breaking)
- v1: field `tags` = string
- v2: field `tags` = array<string> (breaking)

## Steps (Failure: Producer-First)
1) producer를 v2로 먼저 배포(또는 v2 메시지 발행)
2) v1 consumer는 parse 실패 → retry→DLQ 또는 소비 중단/lag 폭증
3) assert: DLQ 증가, consumer lag 증가

## Steps (Success: Consumer-First)
1) consumer를 먼저 “dual read”로 배포:
   - tags가 string이면 [tags]로 upcast
   - tags가 array면 그대로
2) producer를 v2로 배포
3) assert: 장애 없이 소비 가능

## Deliverables
- `contracts/avro/*v1,v2*`
- `experiments/E-006-schema-deploy-order.md`
- `scripts/assert/E-006.sh`
