# B-0331 — 대시보드/알람 규칙 (Lag/Outbox/DLQ/Cache/DB)

## Goal
실험 결과를 한 화면에서 확인하고, 운영 표준에서 중요한 임계치 알람을 정의한다.

## Dashboards (Grafana)
1) Kafka/Broker
- under replicated partitions
- ISR shrink events (가능하면)
- broker request latency
- (선택) topic bytes in/out, produce/fetch rate

2) Consumer Health
- consumer lag (가능하면 group/topic/partition)
- processed rate (records/sec)
- error rate
- DLQ rate

3) Outbox/Relay
- outbox backlog count
- oldest outbox age
- relay retry count / publish failures

4) MySQL
- QPS, slow queries
- connection usage
- lock waits / deadlocks

5) Redis
- hit ratio
- evictions
- memory usage
- command latency(가능하면)

## Alerts (Prometheus rules)
- oldest_outbox_age_seconds > 300 for 5m
- dlq_rate > N/min for 5m
- consumer_lag > threshold for 10m
- redis_hit_ratio < X% for 10m AND db_qps 급증 (스탬피드 신호)
- mysql_connections > 80% for 5m
- under_replicated_partitions > 0 for 2m

## Deliverables
- `infra/prometheus/alerts.yml`
- `infra/grafana/dashboards/*.json` (또는 provisioning yaml + json)

## Acceptance Criteria
- E-003(E-004/E-008) 실행 시 관련 패널/알람이 확실히 반응
- “성공 케이스 vs 실패 케이스” 비교가 한눈에 가능
