# B-0333 — Experiment E-010: Redis Cluster Mode 슬롯/HashTag/Lua/멀티키 제약 실험

## Goal
Redis Cluster Mode에서 발생하는 대표 실패(멀티키/Lua/트랜잭션의 cross-slot 문제)를 재현하고,
HashTag로 해결하는 올바른 사용법을 증명한다.

## Infra
- docker-compose에 Redis Cluster 프로파일 추가: `--profile redis-cluster`
- 최소 3 master (+ replicas optional)
- cluster create 스크립트 제공

## Experiment Scenarios
### (A) 실패: cross-slot 멀티키
- 키:
  - `user:1:profile`
  - `user:1:orders`
- `MGET user:1:profile user:1:orders` 또는 Lua로 두 키를 같이 접근 → CROSSSLOT 에러 재현

### (B) 성공: HashTag로 동일 슬롯 강제
- 키:
  - `user:{1}:profile`
  - `user:{1}:orders`
- 멀티키/Lua 성공 확인

### (C) 실패: 잘못된 HashTag로 hot shard 유발(연결은 E-011로)
- `{hot}` 같은 태그 남발 → 특정 슬롯 집중 위험을 설명 + 관측 포인트 제시

## Deliverables
- `experiments/E-010-redis-cluster-slots.md`
- `scripts/exp run E-010` 연동
- `scripts/assert/E-010.sh`:
  - 실패 케이스에서 CROSSSLOT 확인
  - 성공 케이스에서 정상 응답 확인

## Acceptance Criteria
- cluster 모드에서 실패/성공이 100% 재현됨
- Runbook에 “운영에서 어떻게 키를 설계해야 하는지” 정리됨
