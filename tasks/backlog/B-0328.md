# B-0328 — Experiment E-008: Redis stampede → DB overload 장애 / singleflight로 완화

## Goal
- stampede 방어 없을 때 TTL 동시 만료로 DB QPS 폭증/지연/에러를 재현
- singleflight/soft TTL로 완화되는지 수치로 비교

## Setup
- CACHE_TTL_SECONDS=5, JITTER=0 (동시 만료 유도)
- STAMPEDE_PROTECTION=OFF (실패)
- 부하: k6로 500 rps, 60s

## Steps (Failure)
1) warm cache
2) TTL 만료 시점에 miss 폭증 → DB QPS 폭증 → p95/p99 지연 증가
3) assert:
   - DB 쿼리 수 급증
   - API latency 급증/5xx 가능

## Steps (Success)
- STAMPEDE_PROTECTION=ON 또는 soft TTL 적용
- 동일 부하로 비교:
  - DB 쿼리 수 감소
  - latency 개선

## Deliverables
- `infra/k6/stampede.js`
- `experiments/E-008-cache-stampede.md`
- `scripts/assert/E-008.sh` (DB qps/latency 수치)
