# B-0354 — Observability(AWS): MSK Open Monitoring + Prometheus(AMP) + Grafana + Alarms

## Goal
AWS 환경에서 “재현 실험”을 운영급 관측으로 검증한다:
- consumer lag
- outbox backlog age
- DLQ rate
- DB(Aurora) QPS/locks
- Redis hit/miss/evictions
- MSK broker 지표(JMX/Node exporter)
  을 한 화면/알람으로 확인 가능해야 한다.

## Scope
### A) MSK Open Monitoring enable
- JmxExporter / NodeExporter 활성화
- Prometheus scrape 또는 AMP remote_write 연결

### B) 핵심 지표
- Kafka:
    - consumer lag metrics (port 11001)
    - broker CPU/disk node exporter (port 11002)
- Aurora:
    - CPU, connections, deadlocks, replica lag
- ElastiCache:
    - hit rate, evictions, curr connections
- App:
    - OTel trace + RED metrics(latency/rate/error)

### C) Dashboards/Alarms
- “Degradation 실험”용 알람 세트:
    - DLQ spike
    - outbox oldest age
    - consumer lag 급증
    - DB connections/CPU 임계치
    - Redis evictions

## Deliverables
- infra/aws/observability/* (AMP workspace, Grafana, IAM roles)
- dashboards/*.json (Grafana export)
- docs/OBSERVABILITY.md (어떤 실험이 어떤 그래프로 검증되는지)

## Acceptance Criteria
- AWS에서 실험 실행 시, lag/throughput/오류가 대시보드에 반영됨
- consumer lag + DLQ + outbox age 3종이 최소 한 화면에서 보임
