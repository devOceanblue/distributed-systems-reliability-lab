# B-0330 — Observability Stack 구축 (Prometheus + Grafana + Exporters + Actuator)

## Goal
모든 실험(E-001~E-012)의 성공/실패를 “수치”로 증명할 수 있도록 관측 스택을 구성한다.

## Scope
1) docker-compose 확장
- prometheus
- grafana
- exporters:
  - mysqld_exporter
  - redis_exporter
  - kafka jmx exporter (broker별)
  - (선택) cadvisor/node-exporter

2) Spring Boot 공통 관측
- actuator 활성화
- micrometer-registry-prometheus 추가
- `/actuator/prometheus` 노출

3) 최소 메트릭 요구사항
- command-service / outbox-relay / consumer-service / query-service:
  - http server request duration (p95/p99)
  - error rate(5xx)
  - custom metrics:
    - outbox backlog count (status=NEW)
    - oldest outbox age seconds
    - relay publish success/fail count
    - consumer processed count / dedup skipped count
    - dlq publish count
    - cache hit/miss count(서비스 레벨에서 집계)

## Deliverables
- `docker-compose.yml`에 monitoring 서비스 추가(또는 profile 분리: `--profile obs`)
- `infra/prometheus/prometheus.yml`
- `infra/grafana/provisioning/*` (datasource, dashboards)
- 각 서비스 build.gradle에 actuator/micrometer 의존성 추가 및 설정

## Acceptance Criteria
- Prometheus가 모든 타겟 UP 상태로 스크랩
- Grafana에서 기본 대시보드가 로드되고 지표가 표시됨
- E-008 실행 시 DB QPS/latency, cache miss 폭증이 그래프로 보임
