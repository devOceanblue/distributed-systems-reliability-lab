# B-0351 — Kafka Client Auth: MSK IAM(SASL_SSL + AWS_MSK_IAM/OAUTHBEARER) 프로파일 구현

## Goal
LAB_PROFILE=aws 일 때,
- Spring(Java) 서비스들은 MSK IAM 인증으로 접속 가능해야 하고,
- Python 기반 harness/worker가 있다면 SASL_OAUTHBEARER 방식으로도 접속 가능해야 한다.

## Background (공식 패턴)
- Java: security.protocol=SASL_SSL, sasl.mechanism=AWS_MSK_IAM + IAMLoginModule + IAMClientCallbackHandler
- Non-Java: SASL_OAUTHBEARER + language별 signer 라이브러리

## Scope
### A) Java/Spring (권장: AWS_MSK_IAM)
1) dependency 추가
- software.amazon.msk:aws-msk-iam-auth

2) 공통 설정(ENV Contract에서 주입)
- security.protocol=SASL_SSL
- sasl.mechanism=AWS_MSK_IAM
- sasl.jaas.config=software.amazon.msk.auth.iam.IAMLoginModule required;
- sasl.client.callback.handler.class=software.amazon.msk.auth.iam.IAMClientCallbackHandler

3) Credentials
- AWS_PROFILE(named profile) 로컬 실행 지원
- AWS(ECS/EKS) 배포 시는 task role/IRSA로 자연스럽게 동작하도록

### B) Python harness/worker (있다면) — SASL_OAUTHBEARER
- aws_msk_iam_sasl_signer 기반 token provider 구현
- security_protocol='SASL_SSL'
- sasl_mechanism='OAUTHBEARER'

### C) Smoke test
- aws profile에서:
    - producer 1건 send OK
    - consumer group join + poll OK
- 실패 시 로그 분류:
    - network (timeout)
    - auth (sasl handshake)
    - authz (AccessDenied / policy)

## Deliverables
- libs/kafka-client/ (공통 모듈) 또는 각 서비스별 공통 설정 유틸
- docs/MSK_IAM_CLIENT.md (Java/Spring, Python 예시)
- scripts/smoke/aws-kafka-produce.sh
- scripts/smoke/aws-kafka-consume.sh (짧게 poll)

## Acceptance Criteria
- 로컬에서 `AWS_PROFILE=... LAB_PROFILE=aws`로 실행 시 MSK에 produce/consume 가능
- 실패 로그가 “권한 부족 vs 네트워크”로 구분 가능
