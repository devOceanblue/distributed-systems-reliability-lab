# B-0353 — MSK IAM Authorization: Producer/Consumer/Admin 최소권한 정책 템플릿 확정

## Goal
MSK IAM access control에서
- producer(outbox-relay)
- consumer(consumer-service)
- admin(토픽 생성/변경, schema-registry 운영)
  의 최소권한 정책 템플릿을 확정하고, “권한 부족 장애”를 실험/진단 가능하게 만든다.

## Background
- IAM access control은 Action/Resource가 topic/group/cluster 단위로 분리된다.
- consumer는 group 관련 권한(AlterGroup/DescribeGroup)이 없으면 join/commit에서 막힐 수 있다.
- producer idempotence를 켜면(기본 true인 케이스 포함) 정책 설계가 까다로울 수 있어 문서 예제 기반으로 고정한다.

## Scope
### A) Policy templates (JSON)
1) Producer 역할
- kafka-cluster:Connect
- kafka-cluster:DescribeCluster
- kafka-cluster:*Topic* + WriteData
- (필요 시) WriteDataIdempotently + transactional-id 리소스 포함

2) Consumer 역할
- kafka-cluster:Connect
- kafka-cluster:DescribeTopic + ReadData
- kafka-cluster:AlterGroup + DescribeGroup (group 리소스)
- (DLQ consumer/replay 포함 시) 대상 토픽에 WriteData

3) Admin 역할
- CreateTopic/AlterTopic/DeleteTopic
- Describe/AlterGroup
- (옵션) Schema Registry 운영 권한

### B) 권한 부족을 “실험”으로 재현
- policy에서 group 권한 제거 → consumer join 실패
- 특정 topic만 허용 → 다른 topic write 시 AccessDenied
- idempotent 관련 권한 누락 → producer send 실패(재현 가능하면)

## Deliverables
- infra/aws/iam/policies/*.json
- docs/MSK_IAM_POLICIES.md (각 policy가 필요한 이유/실패 시 증상 매핑)
- scripts/exp E-IAM-001~003 (권한 부족 재현)

## Acceptance Criteria
- Producer/Consumer가 최소권한으로 정상 동작
- 의도적으로 권한을 빼면 “예상한 지점에서” 막히고 로그가 남음
