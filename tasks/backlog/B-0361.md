# B-0361 — E-039a/b Distributed Lock 실패/성공 패턴 실험 추가

## Goal
Redis `SET NX PX` 기반 분산락의 실패 모드를 결정론적으로 재현(E-039a)하고,
동일 실패 주입에서 fencing token + safe unlock으로 최종 적용 정확성을 보장(E-039b)하는 실험을 추가한다.

## Scope
1) E-039a 실패 재현
- S1 TTL 만료 stale owner
- S2 owner 검증 없는 unlock(BAD DEL)
- S3 timeout/재시도 ambiguous path
- S4 crash/restart retry loop

2) E-039b 성공 패턴 검증
- fence token 단조 증가(INCR)
- DB gate(`last_fence_token < token`)로 stale apply 차단
- owner 검증 Lua-safe unlock 모델링

3) 산출물
- 실행 엔트리: `scripts/scenarios/E-039A.sh`, `scripts/scenarios/E-039B.sh`
- 실험 시나리오/검증: `scripts/scenarios/E-039A.sh`, `scripts/assert/E-039A.sh`, `scripts/scenarios/E-039B.sh`, `scripts/assert/E-039B.sh`
- 실험 문서: `experiments/E-039a-distributed-lock-failure-modes.md`, `experiments/E-039b-distributed-lock-fencing-token.md`
- 운영 표준 문서: `docs/standards/distributed-lock-fencing.md`
- 샘플 compose: `experiments/e039/docker-compose.yml`

## Acceptance Criteria
- E-039a에서 각 시나리오별 중복 적용(`applied_count > 1`)이 재현되고 assert 가능
- E-039b에서 동일 주입에도 최종 `applied_count == 1`이 보장되고 stale token 거부 로그가 남음
- Runbook/README/Plans에 실행 경로가 반영됨
