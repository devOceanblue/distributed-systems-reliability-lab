# B-0335 — Experiment E-012: Tx Abort 구간은 read_committed에서 “건너뛴 듯” 보이는 현상 재현/해석

## Goal
Kafka transactional producer에서 abort된 트랜잭션 구간은
- 로그(LEO)에는 존재할 수 있지만
- read_committed consumer에게는 “전달되지 않으며”
- consumer position이 다음 안정 구간으로 이동해 “offset이 건너뛴 듯” 보이는 현상
을 재현하고, 이를 장애가 아니라 “정상 동작”으로 해석하는 방법을 문서화한다.

## Setup
- outbox-relay 또는 별도 tx-producer 모드:
  - PRODUCER_TX_MODE=on
  - transactional.id 고정(단, 인스턴스 1개만 실행)
- consumer-service:
  - isolation.level=read_committed
- 추가 관측:
  - consumer가 “수신한 레코드 offset 리스트”와 “현재 position”을 로그로 남김

## Scenario
1) 트랜잭션 begin
2) 동일 파티션에 레코드 N개 전송(예: offsets 100~109)
3) abortTransaction 실행
4) read_committed consumer는 100~109를 수신하지 않음
5) 다음 정상 메시지(예: 110 이후)부터 다시 수신
6) 결과적으로 로그 상 offset 구간이 “사라진 것처럼/건너뛴 것처럼” 보임

## Verification
- read_uncommitted 디버그 consumer를 별도 실행하면 100~109가 “존재”함을 확인 가능(선택)
- read_committed에서는 그 구간이 전달되지 않음(정상)
- Grafana에서 lag/processed rate의 정체/회복이 보이면 좋음(선택)

## Deliverables
- `experiments/E-012-tx-abort-skiplike.md`
- `scripts/exp run E-012`
- `scripts/assert/E-012.sh`
- Runbook에 “이 현상은 장애가 아니라 트랜잭션 의미(LSO) 때문”이라고 명확히 추가

## Acceptance Criteria
- abort 구간이 read_committed에서 미전달됨이 100% 재현
- 로그/문서로 “왜 그렇게 보이는지(LEO/HW/LSO)”가 연결 설명됨
