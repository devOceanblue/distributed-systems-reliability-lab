# B-0335 — Experiment E-012: Tx Abort 구간은 read_committed에서 “건너뛴 듯” 보이는 현상 (로컬 전용)

## Goal
Kafka transactional producer에서 abort된 트랜잭션 구간이
read_committed consumer에게는 전달되지 않아 “offset이 건너뛴 듯” 보이는 현상을 재현하고,
이를 정상 동작으로 해석하는 방법을 문서화한다.

## IMPORTANT (AWS MSK IAM 제약)
- 본 실험은 트랜잭션 abort + txn marker 처리에 의존한다.
- MSK IAM access control은 Kafka 내부 액션(WriteTxnMarkers 등)에 제약이 있어 트랜잭션 종료 기반 실험이 부적합할 수 있다.
- 따라서 E-012는 **LAB_PROFILE=local (로컬 Kafka)** 에서만 수행한다.

## Setup (local)
- outbox-relay 또는 별도 tx-producer 모드:
    - PRODUCER_TX_MODE=on
    - transactional.id 고정(단, 인스턴스 1개만 실행)
- consumer-service:
    - isolation.level=read_committed
- 관측:
    - consumer가 “수신한 레코드 offset 리스트”와 “현재 position”을 로그로 남김

## Scenario
1) begin
2) 동일 파티션에 레코드 N개 전송(예: offsets 100~109)
3) abortTransaction
4) read_committed consumer는 100~109 미수신
5) 다음 정상 메시지(110+)부터 수신 재개
6) 로그 상 “건너뛴 듯” 보임

## Deliverables
- experiments/E-012-tx-abort-skiplike.md
- scripts/exp E-012
- scripts/assert/E-012.sh
- Runbook에 “정상 동작(LSO)” 설명 추가

## Acceptance Criteria
- abort 구간 미전달 100% 재현
- “왜 그렇게 보이는지(LEO/HW/LSO)”가 문서로 연결됨
