# B-0350 — AWS IaC(dev): MSK Provisioned(IAM) + ElastiCache Redis + Aurora MySQL + VPC

## Goal
실험/운영 검증을 위해 AWS에 dev 환경을 IaC(Terraform)로 구성한다.
로컬(PLAINTEXT)에서 재현한 실험을 AWS(실제 IAM/VPC/Managed failover)에서도 재검증 가능해야 한다.

## Scope
### A) Network
- VPC (3 AZ)
- private subnets (app, data)
- NAT (dev는 1개로 시작 가능)
- SG 분리:
    - app-sg
    - msk-sg (9098 inbound from app-sg)
    - redis-sg (6379 inbound from app-sg)
    - aurora-sg (3306 inbound from app-sg)

### B) MSK Provisioned (IAM access control)
- Broker count: 3 (multi-AZ)
- Authentication: IAM enabled
- Encryption in transit: enabled (SASL_SSL)
- Port: 9098 (VPC 내부 IAM access control 기본 포트)
- Open Monitoring: JMX Exporter / Node Exporter (B-0354에서 상세)

### C) ElastiCache Redis
- Replication Group(권장): primary + replica (failover)
- Parameter group: 최소 튜닝(예: maxmemory-policy) 필요 시

### D) Aurora MySQL
- Aurora MySQL cluster + writer/reader
- (옵션) reader endpoint도 출력해서 read/write 분리 실험 가능하게

### E) Outputs (필수)
- MSK:
    - cluster_arn
    - bootstrap_brokers_sasl_iam (9098)
- Redis:
    - primary_endpoint / reader_endpoint
- Aurora:
    - writer_endpoint / reader_endpoint
- VPC/Subnet/SG ids

## Deliverables
- infra/aws/terraform/ (root module)
- infra/aws/terraform/modules/* (선호 시)
- docs/AWS_ENV.md (apply 방법, outputs 매핑)
- (옵션) Makefile: `make aws-up`, `make aws-down`

## Acceptance Criteria
- `terraform apply` 후 outputs로
    - MSK endpoint(9098) 얻기 가능
    - app-sg에서 9098/6379/3306 접근 가능
- 최소 IAM role/policy와 함께, 로컬에서 “AWS endpoint 붙는 smoke test”가 가능(B-0351/0352)
